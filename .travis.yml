---
language: bash

# Tell Travis to start Docker when it brings up an environment.
services:
  - docker

env:
  global:
  - secure: Dqubghoe1gKXweKnv+8/+sxjW2coL00Zzhzamv0RS66aQ4DZ92yvvCRiyKmCLUX7d884djDLWCZQEaeMFd7upGqnb8ryZoPwp5qiyCTTAE83doU1JSM+qh4fZJbJ4MoM5cxygvSucfcHV6NdUvE1sFsqmYyRHotkhj7UNMi5S9oirL0NRJlQvntGLggQXqfP7hOFuXQkb6snLzZqJaGMFl5+8hzbXDr7hyGo6428fKupW5EyAEHj5JHfdh6HurH10/Tn4f9L9irpl8Gl0VLdRwrE5bePCwIFWO9+qnQxbXkYz8oQIoK4sAt4Al/KoU4gSAC8c+khx0gEHORv5YFbAG9lMfIzd193Roc2nsqa/orZ4P9v6Yqcsdx0w6n62bqyPX3a3NyaBC+J0IbOwvp4lC3+Q+Oe2kF75UyA9maM+ndcXIAvuQm5KVB8dFm+E60UvhFQgUTsz+Om0NE9R+BwZZLnGjphPzDaV+628zP0RSogXB3RG4hLef7036+zozGfQHw9DAJgrIZaIIE3DbQz6DdMEEI8dpyWTTr1wtvUr8UGIB3ZW+7KXDAkJIguaCM4jxmQbnXvRqElDXCD9o3FrOT6pc90hsI6ImcapVLIFMEtWp3/c8c0MIM8Xm77fYflZy0R7FUy6QU0QeKXLF0NyW8g57eIS9GRCuKH8Zv6i1s=
  - secure: D51ghlYYosdyvKpW1vUGME92yIaBskjj/rd997dJxE2dUPdXiqg3xOLZ58v/W8S+FjRAyjrS6DoXXmKnWUPZnZh60CVDEL2DwIU5tuFsaJGz+xBw3D7M8dFxbsfter9b581x+TMBwXD1eeN57m7EcZTvP/Wu8MjmWeThyvE7UVDczmYzBpVgwRnOUj0OjGkQ7jeWi0C/n8f3vMBd59Izrit0+WENAFFfV0bKWiCA5AWq+SJOaVEbc5zDbGXPYjnJhwPPmI2z2gWJp4pQyJTlt4ctnGyngOTPE1A1b0yqDNEambMW5iDLgvS6bxwabLD22d0zZnwwD63yWz3wo/xcowRFiLMLUsBDH8oD324L3B6ry81ZHzpGljkRILSMZRyWse9gZoTT2Xl5myRuyQAHfO3xX5J2R2liDD3fK/U7oJJEmM1KT6X9t7NH5BMqvBmXr96t0oKcmp9pvDp0Edsyr+NnvAT77BFOEZ5HST+fTvuXO1HB+Kqrn83QotZmmCl1CTFO8Kk+YzoksmyZEk13oBJysR8B9ahbFJ0kLgPObih2LswHcSy8sgbila0LypSe+Vt7pknra4CMY7dIKgvUKJO+aneWSOlH3FvOWZmvy+KdCLohx8lNQa74r0GPyeT5hH/c9Sf1y4xkdL6iuOVGciPMMDPnwizOJyDKE1QenzI=
  - secure: bFJOi2Ref5E+AJncrCCcqxQuRGsJ/q/MVgPcVSIhHIwLLEAUlCbH0Li1o1A+DwM/Ap/gCMEo3d3/UwQMldM1xMUJA942ZH8rb+arw08L1809Je0dChcgESBf3SN5yOVKjWU7SmL+7X7uC7yJiTE94xWxnU2p4ZVQV8OjN0Zp83VwUqKyC+U/Z8fwiAiORlNDqdk5Vb5lHXdj+I71xVxatO758B1yS6T3MPpqD3DZ+5vgReQjOBH1NPrCeM2NlpHsTG9D0bOWohGN5THhl16SC0Dxb/tJXqguG8a/fWY6iz1aBxwc/VzwweIrf3T7D2S2xX9mCBoiDXWxYrW+kc/Vq3xPZkJdiuCub/zepac5pr34gnYKvbwF4hawOOI49A/dIqPvgTXsqCzj4qGx5dgFTcYdn+Gh26/svx8TX2AUKrGYRq1UkWUYDpk1qvWjy5X8dw3PDh4DFasNcmGNnGZM8BU+fIxO+YvFnOodzHlvyMwbzwZha8garw8fj2duPfFV31W6hAaDoSnx8C6XSQOHTKuQIb/QDXnNadsFCt6PBOidOc9+RjkN5TiTRvBRaHg4NQvt9nrDlFqHjyerwTQ6teaDehdyyZCN6PS/tNR9GRPKuKdkGnajmvQw+zLbgaFSf+kJDPiBb0KgJhKeTm41o/hut7I2do2aSvTxuyZnNpw=
  matrix:
    # Provide a list of GLPI version to build
    - GLPI_VERSION="9.3.0"

script:
  - export VCS_REF=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then echo $TRAVIS_COMMIT; else echo $TRAVIS_PULL_REQUEST_SHA; fi)
  - export VCS_BRANCH=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then echo $TRAVIS_BRANCH; else echo $TRAVIS_PULL_REQUEST_BRANCH; fi)

  # Download tools shim.
  - wget -O ${PWD}/_tools.sh https://gist.github.com/Wolvverine/cd03f29d68600c8850aeed8fe2b3d464/raw

  # 
  # Build docker image
  #
  - ${PWD}/build.sh

  #
  ## Run tests
  #
  - ${PWD}/tests.sh && touch _test_ok

  #
  # Deploy
  #
  - '[ "$TRAVIS_PULL_REQUEST" == "false" ] || exit 0'
  - '[ "$TRAVIS_SECURE_ENV_VARS" == "true" -a  -n "$DOCKERHUB_REGISTRY_USERNAME" -a -n "$DOCKERHUB_REGISTRY_PASSWORD" ]'
  - '[ -f _test_ok ] && ${PWD}/deploy.sh'
